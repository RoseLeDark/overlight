# Makefile for OverLight
# Generated by configure script

PREFIX = %PREFIX%
BIN_DIR = %BIN_DIR%
SBIN_DIR = %SBIN_DIR%
LIB_DIR = %LIB_DIR%
ETC_DIR = %ETC_DIR%
SYSTEMD_DIR = %SYSTEMD_DIR%
GRUB_DIR = %GRUB_DIR%
GUEST_DIR = %GUEST_DIR%

all: prepare

prepare:
	@echo "OverLight is ready for installation"
	@echo "Run 'sudo make install' to install"

install:
	@echo "Installing OverLight..."
	
	# Create directories
	install -d $(DESTDIR)$(BIN_DIR)
	install -d $(DESTDIR)$(LIB_DIR)/bin
	install -d $(DESTDIR)$(ETC_DIR)
	install -d $(DESTDIR)$(GUEST_DIR)
	
	# Install main script
	install -m 755 overlightcfg.sh $(DESTDIR)$(BIN_DIR)/
	
	# Install library scripts
	install -m 755 bin/*.sh $(DESTDIR)$(LIB_DIR)/bin/
	
	# Install configuration
	install -m 644 etc/overlight.cfg $(DESTDIR)$(ETC_DIR)/
	
	# Install systemd service
	install -d $(DESTDIR)$(SYSTEMD_DIR)
	install -m 644 systemd/overlight.service $(DESTDIR)$(SYSTEMD_DIR)/
	
	# Create example OS structure
	install -d $(DESTDIR)$(GUEST_DIR)/LINUX
	install -m 644 examples/autoload > $(DESTDIR)$(GUEST_DIR)/autoload
	install -m 644 examples/LINUX/config.cfg $(DESTDIR)$(GUEST_DIR)/LINUX/config.cfg
	
	@echo ""
	@echo "Installation complete!"
	@echo ""
	@echo "Next steps:"
	@echo "1. Place your OS image at $(GUEST_DIR)/LINUX/rootfs.squashfs and set sha256 sum in config.cfg"
	@echo "2. Enable service: sudo systemctl enable overlight-early overlight"
	@echo "3. Reboot and enjoy OverLight"

uninstall:
	@echo "Uninstalling OverLight..."
	
	# Remove files
	rm -f $(DESTDIR)$(BIN_DIR)/overlightcfg.sh
	rm -rf $(DESTDIR)$(LIB_DIR)
	rm -rf $(DESTDIR)$(ETC_DIR)
	rm -f $(DESTDIR)$(SYSTEMD_DIR)/overlight.service
	rm -f $(DESTDIR)$(SYSTEMD_DIR)/overlight-early.service
	
	# Don't remove guest directory as it may contain user data
	@echo "Note: Guest directory $(GUEST_DIR) was not removed"
	@echo "(may contain user OS images)"
	
	@echo "Uninstall complete"

clean:
	rm -f config.summary

.PHONY: all prepare install uninstall clean